platform: linux

image_resource:
  type: docker-image
  source: {repository: hashicorp/terraform}

inputs:
  - name: concourse

outputs:
  - name: schema

params:
  - env:
    - TF_V1: "secret1"
    - TF_V2: "secret2"
    - TF_V2: "secret2"
run:
  path: sh
  args:
  - -exc
  - |
    ls
    JQ_URL="https://circle-downloads.s3.amazonaws.com/circleci-images/cache/linux-amd64/jq-latest" 
    curl --silent --show-error --location --fail --retry 3 --output /usr/bin/jq $JQ_URL
    chmod +x /usr/bin/jq
    jq --version
    for row in $(echo "${env}" | jq -r '.[] | @base64'); do
      KEY="$(echo ${row} | base64 --decode | jq -r 'keys[]')"
      VALUE="$(echo ${row} | base64 --decode | jq -r 'values[]')"
      export TF_V1="$(echo ${row} | base64 --decode | jq -r 'values[]')"
    done
    echo "${TF_V1}"
    echo "$TF_V2"
    echo "$TF_V3"
