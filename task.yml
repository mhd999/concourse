platform: linux

image_resource:
  type: docker-image
  source: {repository: hashicorp/terraform}

inputs:
  - name: concourse

outputs:
  - name: schema

params:
  - env:
    - TF_V1: "secret1"
    - TF_V2: "secret2"
    - TF_V2: "secret2"
run:
  path: sh
  args:
  - -exc
  - |
    ls
    curl -o /usr/bin/jq http://stedolan.github.io/jq/download/linux64/jq
    chmod +x /usr/bin/jq
    echo "$env"
    for row in $(echo "${env}" | jq -r '.[] | @base64'); do
      key=$(echo ${row} | base64 --decode | jq -r 'keys[]')
      value=$(echo ${row} | base64 --decode | jq -r 'values[]')
      echo export x="123"
    done
    echo "$x"
