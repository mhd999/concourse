platform: linux

image_resource:
  type: docker-image
  source: {repository: hashicorp/terraform}

inputs:
  - name: concourse

outputs:
  - name: schema

params:
  - envs:
    - TF_V1: "secret1"
    - TF_V2: "secret2"
    - TF_V2: "secret2"
run:
  path: sh
  args:
  - -exc
  - |
    ls
    JQ_URL="https://circle-downloads.s3.amazonaws.com/circleci-images/cache/linux-amd64/jq-latest" 
    curl --silent --show-error --location --fail --retry 3 --output /usr/bin/jq $JQ_URL
    chmod +x /usr/bin/jq
    jq --version
    echo $envs
    echo -----------
    for obj in $(echo "${envs}" | jq -r '.[] | @base64'); do
      ENV_VAR="$(echo ${obj} | base64 --decode | jq -r "to_entries|map(\"\(.key)=\(.value|tostring)\")|.[]")"
      export $ENV_VAR
    done
    echo $TF_V1
    echo $TF_V2
    echo $TF_V3

